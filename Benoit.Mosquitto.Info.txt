1.1 Test avec 1883, 1884, 8883 et 8884
1.2 Test pour mosquitto avec device comme AP
1.3 Supprimer la compilation de mosquitto (src) et apps et pluging qui utilise WITH_BROKER ou ne sont pas utile
1.4 Git commit 

/******************************************************************************
    1.1 Test avec 1883, 1884, 8883 et 8884
 ******************************************************************************/

Test avec 1883, 1884, 8883 et 8884

test.mosquitto.org
./mosquitto_pub --help

PS C:\Apps\mosquitto> ./mosquitto_pub --help
mosquitto_pub is a simple mqtt client that will publish a message on a single topic and exit.
mosquitto_pub version 2.0.14 running on libmosquitto 2.0.14.

Usage: mosquitto_pub {[-h host] [--unix path] [-p port] [-u username] [-P password] -t topic | -L URL}
                     {-f file | -l | -n | -m message}
                     [-c] [-k keepalive] [-q qos] [-r] [--repeat N] [--repeat-delay time] [-x session-expiry]
                     [-A bind_address] [--nodelay]
                     [-i id] [-I id_prefix]
                     [-d] [--quiet]
                     [-M max_inflight]
                     [-u username [-P password]]
                     [--will-topic [--will-payload payload] [--will-qos qos] [--will-retain]]
                     [{--cafile file | --capath dir} [--cert file] [--key file]
                       [--ciphers ciphers] [--insecure]
                       [--tls-alpn protocol]
                       [--tls-engine engine] [--keyform keyform] [--tls-engine-kpass-sha1]]
                       [--tls-use-os-certs]
                     [--psk hex-key --psk-identity identity [--ciphers ciphers]]
                     [--proxy socks-url]
                     [--property command identifier value]
                     [-D command identifier value]
       mosquitto_pub --help

 -A : bind the outgoing socket to this host/ip address. Use to control which interface
      the client communicates over.
 -d : enable debug messages.
 -c : disable clean session/enable persistent client mode
      When this argument is used, the broker will be instructed not to clean existing sessions
      for the same client id when the client connects, and sessions will never expire when the
      client disconnects. MQTT v5 clients can change their session expiry interval with the -x
      argument.
 -D : Define MQTT v5 properties. See the documentation for more details.
 -f : send the contents of a file as the message.
 -h : mqtt host to connect to. Defaults to localhost.
 -i : id to use for this client. Defaults to mosquitto_pub_ appended with the process id.
 -I : define the client id as id_prefix appended with the process id. Useful for when the
      broker is using the clientid_prefixes option.
 -k : keep alive in seconds for this client. Defaults to 60.
 -L : specify user, password, hostname, port and topic as a URL in the form:
      mqtt(s)://[username[:password]@]host[:port]/topic
 -l : read messages from stdin, sending a separate message for each line.
 -m : message payload to send.
 -M : the maximum inflight messages for QoS 1/2..
 -n : send a null (zero length) message.
 -p : network port to connect to. Defaults to 1883 for plain MQTT and 8883 for MQTT over TLS.
 -P : provide a password
 -q : quality of service level to use for all messages. Defaults to 0.
 -r : message should be retained.
 -s : read message from stdin, sending the entire input as a message.
 -t : mqtt topic to publish to.
 -u : provide a username
 -V : specify the version of the MQTT protocol to use when connecting.
      Can be mqttv5, mqttv311 or mqttv31. Defaults to mqttv311.
 -x : Set the session-expiry-interval property on the CONNECT packet. Applies to MQTT v5
      clients only. Set to 0-4294967294 to specify the session will expire in that many
      seconds after the client disconnects, or use -1, 4294967295, or Γê₧ for a session
      that does not expire. Defaults to -1 if -c is also given, or 0 if -c not given.
 --help : display this message.
 --nodelay : disable Nagle's algorithm, to reduce socket sending latency at the possible
             expense of more packets being sent.
 --quiet : don't print error messages.
 --repeat : if publish mode is -f, -m, or -s, then repeat the publish N times.
 --repeat-delay : if using --repeat, wait time seconds between publishes. Defaults to 0.
 --unix : connect to a broker through a unix domain socket instead of a TCP socket,
          e.g. /tmp/mosquitto.sock
 --will-payload : payload for the client Will, which is sent by the broker in case of
                  unexpected disconnection. If not given and will-topic is set, a zero
                  length message will be sent.
 --will-qos : QoS level for the client Will.
 --will-retain : if given, make the client Will retained.
 --will-topic : the topic on which to publish the client Will.
 --cafile : path to a file containing trusted CA certificates to enable encrypted
            communication.
 --capath : path to a directory containing trusted CA certificates to enable encrypted
            communication.
 --cert : client certificate for authentication, if required by server.
 --key : client private key for authentication, if required by server.
 --keyform : keyfile type, can be either "pem" or "engine".
 --ciphers : openssl compatible list of TLS ciphers to support.
 --tls-version : TLS protocol version, can be one of tlsv1.3 tlsv1.2 or tlsv1.1.
                 Defaults to tlsv1.2 if available.
 --insecure : do not check that the server certificate hostname matches the remote
              hostname. Using this option means that you cannot be sure that the
              remote host is the server you wish to connect to and so is insecure.
              Do not use this option in a production environment.
 --tls-engine : If set, enables the use of a TLS engine device.
 --tls-engine-kpass-sha1 : SHA1 of the key password to be used with the selected SSL engine.
 --tls-use-os-certs : Load and trust OS provided CA certificates.
 --psk : pre-shared-key in hexadecimal (no leading 0x) to enable TLS-PSK mode.
 --psk-identity : client identity string for TLS-PSK mode.
 --proxy : SOCKS5 proxy URL of the form:
           socks5h://[username[:password]@]hostname[:port]
           Only "none" and "username" authentication is supported.

See https://mosquitto.org/ for more information.

PS C:\Apps\mosquitto>
1883 : MQTT, unencrypted, unauthenticated

./mosquitto_sub   -t sensors/temperature -p 1883 -q 1 -h test.mosquitto.org

Il va afficher les résultats des publications de tout les gens qui publient à sensors/temperature.


./mosquitto_pub -h test.mosquitto.org  -t sensors/temperature -m "32.123" -q 1 

./mosquitto_pub   -h test.mosquitto.org -t sensors/temperature -m "32.1234" -q 1 -p 1883  
1884 : MQTT, unencrypted, authenticated

 [-u username [-P password]]

The authenticated listeners require a username / password:

    rw / readwrite : read/write access to the # topic hierarchy
    ro / readonly : read only access to the # topic hierarchy
    wo / writeonly : write only access to the # topic hierarchy

./mosquitto_pub   -h test.mosquitto.org -t sensors/temperature -m "32.1234" -q 1 -p 1884 -u rw -P readwrite
8883 : MQTT, encrypted, unauthenticated

The encrypted ports support TLS v1.3, v1.2 or v1.1 with x509 certificates and require client support to connect. For ports 8883 and 8884 you should use the certificate authority file (mosquitto.org.crt (PEM format), or mosquitto.org.der (DER format)) to verify the server connection. Ports 8081 and 8886 have a Lets Encrypt certificate, so you should use your system CA certificates or the appropriate Lets Encrypt CA certificate for verification.

mosquitto.org.crt Wireshark

mosquitto.org.der

 ./mosquitto_pub   -h test.mosquitto.org -t sensors/temperature -m "32.1234" -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8883 --cafile mosquitto.org.crt

./mosquitto_sub -h test.mosquitto.org  -t sensors/temperature -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8883 --cafile mosquitto.org.crt

 ./mosquitto_pub   -h test.mosquitto.org -t sensors/temperature -m "32.1234" -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8883 --cafile ../CA/mosquitto.org.crt

./mosquitto_sub -h test.mosquitto.org  -t sensors/temperature -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8883 --cafile ../CA/mosquitto.org.crt
8884 : MQTT, encrypted, client certificate required

./mosquitto_sub -h test.mosquitto.org  -t sensors/temperature -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8884 --cafile mosquitto.org.crt --key client.key --cert client.crt.txt

./mosquitto_sub -h test.mosquitto.org  -t sensors/temperature -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8884 --cafile ../CA/mosquitto.org.crt --key ../CA/client.key --cert ../CA/client.crt.txt

./mosquitto_pub -h test.mosquitto.org -t sensors/temperature -m "allo" -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8884 --cafile ../CA/mosquitto.org.crt --key ../CA/client.key --cert ../CA/client.crt.txt


8885 : MQTT, encrypted, authenticated

./mosquitto_sub -h test.mosquitto.org  -t sensors/temperature -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8885 --cafile mosquitto.org.crt  -u rw -P readwrite



/******************************************************************************
    1.2 Test pour mosquitto avec device comme AP
 ******************************************************************************/

./mosquitto_pub -h test.mosquitto.org -t "device/" -m "20:4c:03:90:e0:56" -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8884 --cafile ../CA/mosquitto.org.crt --key ../CA/client.key --cert ../CA/client.crt.txt
./mosquitto_pub -h test.mosquitto.org -t "device/20:4c:03:90:e0:56/" -m "m1" -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8884 --cafile ../CA/mosquitto.org.crt --key ../CA/client.key --cert ../CA/client.crt.txt
./mosquitto_pub -h test.mosquitto.org -t "device/20:4c:03:90:e0:56/v2/hello" -m "hello" -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8884 --cafile ../CA/mosquitto.org.crt --key ../CA/client.key --cert ../CA/client.crt.txt
./mosquitto_pub -h test.mosquitto.org -t "device/20:4c:03:90:e0:56/v2/devconf" -m "allo" -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8884 --cafile ../CA/mosquitto.org.crt --key ../CA/client.key --cert ../CA/client.crt.txt
./mosquitto_sub -h test.mosquitto.org -t "device/20:4c:03:90:e0:56/#"  -q 1 --tls-alpn  "x-amzn-mqtt-ca" -p 8884 --cafile ../CA/mosquitto.org.crt --key ../CA/client.key --cert ../CA/client.crt.txt




/******************************************************************************
    1.3 Supprimer la compilation de mosquitto (src) et apps et pluging qui utilise WITH_BROKER ou ne sont pas utile
 ******************************************************************************/
Voir la liste des git commits
Changement dans ./Makefile


/******************************************************************************
    1.4 Git commits
 ******************************************************************************/
commit cf4b6d8389cafad385df9f1aded71500f487b282 (HEAD -> b/Test_nettoiyer_le_tout)
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Fri Jan 21 21:21:53 2022 -0500

    Supprimer le repertoire client, le suivi se fait dans ben.

commit aa42a779a36cc679f86c95156c4a1989ca8d531b
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Fri Jan 21 21:14:49 2022 -0500

    VSCODE, Mise à jour des #define

commit 659b969256e2452436307d9a1d0c0867b6789be4
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Fri Jan 21 21:13:48 2022 -0500

    Supprimer les repertoire src, apps et plugins

commit 970f7f16848995764c5a6e8dd9914bd02b89a407
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Fri Jan 21 21:04:40 2022 -0500

    Mise a jour des commits

commit 81cb22e93f7458c012e5039a17692cf285e0d751
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Fri Jan 21 21:03:19 2022 -0500

    Supprime des #if conditionnal inutile

commit 6697fa536ed6780e918b237fe1d185d9150b173a
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Fri Jan 21 17:10:53 2022 -0500

    VSCODE settings.json, files.excludes
    
    Ajout des fichiers a ne pas inclure dans files.excludes

commit 1b0601b73a2832b82f533eed62e8d0969d3bbd00
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Fri Jan 21 17:08:07 2022 -0500

    Mise a jour de .gitignore avec libmosquitto.pc et libmosquittopp.pc

commit ad7d0f14665a97793a48d529b1e9fc24998bf3ed
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Fri Jan 21 17:05:13 2022 -0500

*******************
Référence dans ce document à 1.3 Supprimer la compilation de mosquitto (src) et apps et pluging qui utilise WITH_BROKER ou ne sont pas utile
*******************

Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Fri Jan 21 17:00:45 2022 -0500

    Suppression des repertoires src, apps et plugins
    
    Ces repertoires ne sont pas utiles pour les apps clients

commit b0c1eefa90ea75cfffb902b39eaffd93222cb9ab
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Tue Jan 18 20:11:11 2022 -0500

    Mise a jour de la config c_cpp pour vscode

commit 0de3930ac2c23eca80e06730886f9da45bbf7fdd (origin/b/build_ok_tests_ok, b/build_ok_tests_ok)
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Tue Jan 18 16:53:02 2022 -0500

    Ajout de l'env VSCode pour mosquitto

commit 9d05f1adc50485a06ec26aeb59c5135c61108e51
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Tue Jan 18 16:52:12 2022 -0500

    Ajout de commentaires seulement

commit cad1b42d169270a52c6ff37bf20852f8b244a7e9
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Sun Jan 16 22:14:41 2022 -0500

    Ajout du repertoire ben image de client pour debogage
    
    Ajout de BLog() et autres code de debogage

commit a3dd99c26c2d94235747fd7dfb57ab831f434b91
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Sun Jan 16 19:46:45 2022 -0500

    Ajout de BLog dans les fichiers src/

commit f55314e53ff508069ac23f6d35bc7847e20ae542
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Sun Jan 16 19:40:09 2022 -0500

    Ajout de deboggage BLog, BTraceIn, BTraceOut... (config.h)
    
    Certains autres printf...
    Aucun changement de fonctionnalites

commit dfe077a011dc62ba202a7fda8f93b923d7099bfd
Author: Benoit Massé <ben.masse@abcdn.qc.ca>
Date:   Sun Jan 16 18:34:46 2022 -0500

    Generer avec instruction Benoit.txt
    
    Exemple de tests avec les certificats et clefs dans le repertoire ./CA

commit 3cbe805e71ac41a2a20cc9b2ea6b3b619f49554a (upstream/master, upstream/fixes, upstream/coverity-fixes, origin/master, origin/fixes, origin/coverity-fixes, origin/HEAD, master)
Author: Roger A. Light <roger@atchoo.org>
Date:   Wed Nov 17 00:30:52 2021 +0000

    Update docker.